rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /schedules/{document=**} {
      // Autoriser la lecture et l'écriture pour tous les utilisateurs
      allow read, write: if true;
      
      // Validation des données pour la création
      allow create: if request.resource.data.keys().hasAll(['name', 'schedules', 'employees', 'weekNumber', 'year', 'createdAt']) &&
                   request.resource.data.weekNumber is number &&
                   request.resource.data.weekNumber >= 1 &&
                   request.resource.data.weekNumber <= 53 &&
                   request.resource.data.year is number &&
                   request.resource.data.year >= 2000 &&
                   request.resource.data.year <= 2100 &&
                   request.resource.data.employees is list &&
                   request.resource.data.name is string &&
                   request.resource.data.name.size() <= 100;
      
      // Validation des données pour la mise à jour
      allow update: if request.resource.data.keys().hasAll(['name', 'schedules', 'employees', 'weekNumber', 'year', 'updatedAt']) &&
                   request.resource.data.weekNumber is number &&
                   request.resource.data.weekNumber >= 1 &&
                   request.resource.data.weekNumber <= 53 &&
                   request.resource.data.year is number &&
                   request.resource.data.year >= 2000 &&
                   request.resource.data.year <= 2100 &&
                   request.resource.data.employees is list &&
                   request.resource.data.name is string &&
                   request.resource.data.name.size() <= 100;
    }
  }
}